<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6" *ngIf="selectedParcel; else noParcel">
    <h3 class="text-lg font-semibold text-gray-800 mb-6 flex items-center">
      <mat-icon class="text-blue-600 mr-2">check_circle</mat-icon>
      Update Parcel Status
    </h3>
  
    <!-- Selected Parcel -->
    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
      <h4 class="font-medium text-gray-800 mb-2">Selected Parcel</h4>
      <p class="text-sm text-gray-600">
        <span class="font-medium">ID:</span> {{ selectedParcel.id }} â€¢
        <span class="font-medium">Title:</span> {{ selectedParcel.title }}
      </p>
      <p class="text-sm text-gray-600 mt-1">
        <span class="font-medium">Customer:</span> {{ selectedParcel.receiverEmail }}
      </p>
    </div>
  
    <!-- Status Progress -->
    <div class="mb-6">
      <h4 class="font-medium text-gray-800 mb-4">Delivery Progress</h4>
      <div class="flex items-center justify-between">
        <ng-container *ngFor="let status of statusFlow; let i = index">
          <div class="flex flex-col items-center">
            <div
              class="w-10 h-10 rounded-full flex items-center justify-center border-2"
              [ngClass]="{
                'bg-blue-100 border-blue-500': status.value === selectedParcel.status,
                'bg-green-100 border-green-500': i < currentStatusIndex,
                'bg-gray-100 border-gray-300': i > currentStatusIndex
              }"
            >
              <mat-icon
                class="w-5 h-5"
                [ngClass]="{
                  'text-blue-600': status.value === selectedParcel.status,
                  'text-green-600': i < currentStatusIndex,
                  'text-gray-400': i > currentStatusIndex
                }"
              >
                {{ status.icon }}
              </mat-icon>
            </div>
            <span class="text-xs mt-2 text-center" [ngClass]="{
              'text-gray-800 font-medium': i <= currentStatusIndex,
              'text-gray-500': i > currentStatusIndex
            }">
              {{ status.label }}
            </span>
          </div>
  
          <div
            *ngIf="i < statusFlow.length - 1"
            class="flex-1 h-0.5 mx-2"
            [ngClass]="{
              'bg-green-500': i < currentStatusIndex,
              'bg-gray-300': i >= currentStatusIndex
            }"
          ></div>
        </ng-container>
      </div>
    </div>
  
    <!-- Update Section -->
    <div *ngIf="nextStatus" class="space-y-4">
      <div>
        <label for="notes" class="block text-sm font-medium text-gray-700 mb-2">
          Add Notes (Optional)
        </label>
        <textarea
          id="notes"
          [(ngModel)]="notes"
          placeholder="Add any relevant notes about this status update..."
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none"
          rows="3"
        ></textarea>
      </div>
  
      <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg">
        <div class="flex items-center">
          <span class="text-sm text-gray-600">Update status to:</span>
          <span class="ml-2 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
            {{ nextStatus.label }}
          </span>
        </div>
        <mat-icon class="text-blue-600">arrow_forward</mat-icon>
      </div>
  
      <button
        (click)="handleStatusUpdate(nextStatus.value)"
        [disabled]="isUpdating"
        class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
      >
        <ng-container *ngIf="isUpdating; else updateText">
          <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>
          Updating Status...
        </ng-container>
        <ng-template #updateText>
          <mat-icon class="mr-2">check_circle</mat-icon>
          Update to {{ nextStatus.label }}
        </ng-template>
      </button>
    </div>
  
    <!-- Delivered Message -->
    <div
      *ngIf="selectedParcel.status === 'DELIVERED'"
      class="p-4 bg-green-50 rounded-lg border border-green-200 mt-4"
    >
      <div class="flex items-center">
        <mat-icon class="text-green-600 mr-2">check_circle</mat-icon>
        <span class="text-green-800 font-medium">Parcel Delivered Successfully</span>
      </div>
      <p class="text-green-700 text-sm mt-1">
        This parcel has been marked as delivered and no further status updates are needed.
      </p>
    </div>
  </div>
  
  <ng-template #noParcel>
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
      <div class="text-center py-8">
        <mat-icon class="w-12 h-12 text-gray-400 mb-4" style="font-size: 48px">info</mat-icon>
        <h3 class="text-lg font-medium text-gray-800 mb-2">No Parcel Selected</h3>
        <p class="text-gray-500">Please select a parcel from the list to update its status.</p>
      </div>
    </div>
  </ng-template>
  